<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Gestion d'évenements</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
	
	<header>
	    <h1>Gestion d'évenements</h1>
	</header>
	
	<nav>
	    <a href="#" onclick="switchPage('Evenement')">Evenement</a>
	    <a href="#"  onclick="switchPage('Membres')">Membres</a>
	    <a href="#" onclick="switchPage('Lieu')">Lieu</a>
	    <a href="#" onclick="switchPage('Commentaire')">Commentaires</a>
	</nav>
	
	<section id="content">
	
		<!-- ////////////////////////////////EVENEMENT////////////////////////////////////////////////////-->
	    <div id="pageEvenement">
	        <!-- Contenu de la page Evenement -->
	    </div>
	
		<!-- //////////////////////////////////MEMBRE/////////////////////////////////////////////////////-->
	    <div id="pageMembres" style="display:none;">
	        <!-- Contenu de la page Membres -->
	    </div>
	
		<!-- ///////////////////////////////////LIEU/////////////////////////////////////////////////////// -->
	    <div id="pageLieu" style="display:none;">
	        <main id="app1">
	        <h1>Gestion des lieux en Vue</h1>
	        <p>Sélectionnez un lieu dans la liste :</p>
	        <select v-model="leLieu" style="width:250px" @change="chargerLieu">
	            <option v-for="lieu in lieux" :value="lieu">
	                {{ lieu.nom }}
	            </option>
	        </select>
	        <div v-show="selectionne">
	            <p><br />Editez ses propriétés :</p>
	            <table>
	            	<tr><td>Id</td><td><input v-model="leLieu.idLieu"/></td></tr>
	                <tr><td>Nom</td><td><input v-model="leLieu.nom"/></td></tr>
	                <tr><td>Adresse</td><td><input v-model="leLieu.adresse"/></td></tr>
	                <tr><td>Capacité maximale</td><td><input v-model="leLieu.nbMaxPers"/></td></tr>

	            </table>
	            <button @click="modifierLieu">Enregistrer les modifications</button>
	        </div>
	        <br />
	        <br />
	         <h2>Ajouter un nouveau lieu :</h2>
	        <form action="lieux?operation=ajouterLieu" method="post">
		        <label for="nom">Nom du lieu:</label>
		        <input type="text" id="nom" name="nom" required><br>
				 <br />
		        <label for="adresse">Adresse:</label>
		        <input type="text" id="adresse" name="adresse" required><br>
				 <br />
		        <label for="nbMaxPers">Nombre maximal de personnes:</label>
		        <input type="number" id="nbMaxPers" name="nbMaxPers" required><br>
				 <br />
		        <button type="submit">Ajouter</button>
		    </form>
		    <br />
		    <br />
		    <br />
		    <h2>Supprimer un lieu</h2>

		    <form action="lieux?operation=supprimerLieu" method="post">
		        <label for="id">Id:</label>
		        <input type="text" id="id" name="id" required><br>
				 <br />
		        <button type="submit">Supprimer</button>
		    </form>
		    
		    <br />
			    <h2>Afficher le lieu d'id:</h2>
			    <form>
				    <label for="id_lieu">Id:</label>
				    <input type="text" id="id_lieu" name="id_lieu" v-model="id_lieu" required><br>
				    <br />
				    <button @click.prevent="getLieuParId">Chercher</button><br />
				</form>
			     <div v-for="lieu in lieuParId" :key="lieu.id_lieu"> 
		            <p>lieu : {{ lieu.nom }}</p>
		        </div>
	    </main>
	    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
	    <script>
	    	function ajouterLieu() {
		        const form = document.getElementById("lieuForm");
		        const formData = new FormData(form);
	
		        fetch('lieux?operation=ajouterLieu', {
		            method: 'POST',
		            body: formData
		        })
		        .then(response => response.json())
		        .then(data => {
		            // Afficher la réponse du serveur dans la div responseContainer
		            const responseContainer = document.getElementById("responseContainer");
		            responseContainer.innerHTML = `<p>Réponse du serveur : ${JSON.stringify(data)}</p>`;
		        })
		        .catch(error => {
		            // Gérer les erreurs de la requête ici
		            console.error('Erreur lors de la requête Fetch :', error);
		        });
		    }
	        const Lieux = {
	            data() {
	                return {
	                    selectionne: false,
	                    lieux: [],
	                    leLieu: [],
	                    lieuParId: [],
	                    nouveauLieu: { 'adresse': {} }
	                }
	            },
	            watch: {
	                leLieu(nouvelleValeur, ancienneValeur) {
	                    this.selectionne = true;
	                }
	            },
	            created()  {
	                fetch('http://localhost:8080/Projet_Servlet/lieux?operation=listeLieux')
	                    .then((response) => response.json())
	                    .then((json) => {this.lieux = json});
	            },
	            methods:  {
	            	getLieuParId(){
	            		fetch(`http://localhost:8080/Projet_Servlet/lieux?operation=getLieuParId&id_lieu=${this.id_lieu}`)	
		            		.then((response) => response.json())
		                    .then((json) => {this.lieuParId = json});
	            	},
            	    modifierLieu() {
            	        fetch(`http://localhost:8080/Projet_Servlet/lieux?operation=modifierLieu&id_lieu=${this.leLieu.idLieu}`, {
            	          method: 'POST',
            	          headers: {
            	            'Content-Type': 'application/json',
            	          },
            	          body: JSON.stringify({
            	            nouveauNom: this.leLieu.nom,
            	            nouvelleAdresse: this.leLieu.adresse,
            	            nouveauNbMaxPers: this.leLieu.nbMaxPers,
            	          }),
            	        })
            	       
            	      },
            	    },
	            
	        }
	        const app1 = Vue.createApp(Lieux).mount('#app1')
	    </script>
	    </div>
	
		<!-- /////////////////////////////////////////////COMMENTAIRE///////////////////////////////////////////////////////////// -->
	    <div id="pageCommentaire" style="display:none;">
	       	<main id="app2">
		        <p>Il y a {{ nbCommentaires }} commentaires dans la base.</p>
		        <div v-for="commentaire in commentaires" :key="commentaire.id_message"> 
		            <p>message : {{ commentaire.message }}</p>
		            <p>Id evenement : {{ commentaire.id_evenement }}</p>
		        </div>
		        <br />
		        <br />
		        <h2>Ajouter un nouveau commentaire :</h2>
		        <form action="commentaires?operation=ajouterCommentaire" method="post">
			        <label for="id_evenement">Id de l'évenement:</label>
			        <input type="text" id="id_evenement" name="id_evenement" required><br>
					 <br />
					 <label for="id_message">Id du message:</label>
			        <input type="text" id="id_message" name="id_message" required><br>
					 <br />
			        <label for="message">Commentaire:</label>
			        <input type="text" id="message" name="message" required><br>
					<br />
			        <button type="submit">Ajouter</button>
			    </form>
			    <br />
			    <br />
			    
			    <h2>Supprimer un commentaire</h2>
			    <form action="commentaires?operation=supprimerCommentaire" method="post">
			        <label for="id_message">Id:</label>
			        <input type="text" id="id_message" name="id_message" required><br>
					 <br />
			        <button type="submit">Supprimer</button>
			    </form>
			    <br />
			    <h2>Modifier un commentaire :</h2>
		        <form action="commentaires?operation=modifierCommentaire" method="post">
					 <label for="id_message">Id du message:</label>
			        <input type="text" id="id_message" name="id_message" required><br>
					 <br />
			        <label for="nouveau_message">Nouveau message:</label>
			        <input type="text" id="nouveau_message" name="nouveau_message" required><br>
					<br />
			        <button type="submit">Modifier</button>
			    </form>
			    <br />


			    
			    <br />
			    <h2>Afficher les commentaires de l'évennement d'id:</h2>
			    <form>
				    <label for="id_evenement">Id:</label>
				    <input type="text" id="id_evenement" name="id_evenement" v-model="id_evenement" required><br>
				    <br />
				    <button @click.prevent="getCommentairesParEvenement">Chercher</button><br />
				</form>
			     <div v-for="commentaire in commentairesParEvenement" :key="commentaire.id_message"> 
		            <p>message : {{ commentaire.message }}</p>
		        </div>
		    </main>
		    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
		    <script>
		        const Commentaires = {
		            data() {
		                return {
		                    auteur: "Charlotte",
		                    commentaires: [],
		                    commentairesParEvenement: [],
		                }    
		            },
		            created()  {
		                fetch('http://localhost:8080/Projet_Servlet/commentaires?operation=listeCommentaires')
		                    .then((response) => response.json())
		                    .then((json) => {this.commentaires = json});
		            },
		            computed: {
		                nbCommentaires() {
		                    return this.commentaires.length
		                }
		            },
		            methods:  {
		            	getCommentairesParEvenement(){
		            		fetch(`http://localhost:8080/Projet_Servlet/commentaires?operation=CommentairesParEvenement&id_evenement=${this.id_evenement}`)	
			            		.then((response) => response.json())
			                    .then((json) => {this.commentairesParEvenement = json});
		            	},
		            },
		        }
		        const app2 = Vue.createApp(Commentaires).mount('#app2')
		        window.getCommentairesParEvenement = app2.getCommentairesParEvenement;
		    </script>
	    </div>
	</section>
	
	<!-- /////////////////////////////// SCRIPT //////////////////////////////////////////////////// -->
	<script>
	
	function switchPage(page) {
	    // Masquer toutes les pages
	    document.getElementById('pageEvenement').style.display = 'none';
	    document.getElementById('pageMembres').style.display = 'none';
	    document.getElementById('pageLieu').style.display = 'none';
	    document.getElementById('pageCommentaire').style.display = 'none';
	
	    
	    document.getElementById('page' + page).style.display = 'block';
	}
	
	</script>

</body>
</html>
